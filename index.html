/*
FutureMind - Single-file React component
Place this file in a React project (e.g. create-react-app). Tailwind CSS is used for styling. 
Instructions to run:
1) Create React app: npx create-react-app futuremind
2) Install Tailwind per Tailwind docs OR use a CDN build for quick test (for production use Tailwind properly).
3) Add this component as src/App.jsx and run `npm start`.

Notes on functionality implemented client-side:
- Animated rocket on landing with "Created by Asus Kumar" and a book image.
- Quick quiz generator from typed text or from an uploaded image using Tesseract.js (client-side OCR).
- "Generate question paper" extracts the longest/most complex sentences from image/text as "hard questions".
- "Friend" button triggers a dangerous animation (red pulse + shake), then reveals group-add UI.
- Group UI shows online count, ability to add mock users, and a built-in chat with gallery (attach images) and "generate quiz" button.

This is a front-end only demo. OCR accuracy depends on Tesseract; for best results, use clear images.
*/

import React, { useState, useRef } from "react";

// Load Tesseract via CDN - in index.html add: 
// <script src="https://unpkg.com/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>
// If you don't want OCR, users can type/paste text.

export default function FutureMindApp() {
  const [page, setPage] = useState("home");
  const [message, setMessage] = useState("");
  const [chatMessages, setChatMessages] = useState([]);
  const [onlineUsers, setOnlineUsers] = useState(["Asus", "Priya", "Ravi"]);
  const [groupVisible, setGroupVisible] = useState(false);
  const [dangerAnim, setDangerAnim] = useState(false);
  const [ocrLoading, setOcrLoading] = useState(false);
  const [ocrText, setOcrText] = useState("");
  const [generatedQuiz, setGeneratedQuiz] = useState([]);
  const fileInputRef = useRef(null);
  const [uploadedImageURL, setUploadedImageURL] = useState(null);

  // Utility: split text into candidate "questions" and pick hardest ones by length
  function extractHardQuestions(text, count = 5) {
    if (!text) return [];
    // Split by question marks, newlines, and sentences
    const raw = text
      .replace(/\r/g, "\n")
      .split(/[\n?.!]+/) // split on punctuation
      .map(s => s.trim())
      .filter(Boolean);
    // heuristics: longer sentences are probably harder
    raw.sort((a, b) => b.length - a.length);
    return raw.slice(0, count).map((q, i) => ({ id: i + 1, text: q }));
  }

  async function handleImageUpload(e) {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    setUploadedImageURL(url);
    if (!window.Tesseract) {
      alert("Tesseract.js not loaded. Add the CDN script to index.html to enable OCR.");
      return;
    }
    setOcrLoading(true);
    try {
      // @ts-ignore
      const { createWorker } = window.Tesseract;
      const worker = createWorker({ logger: m => console.log(m) });
      await worker.load();
      await worker.loadLanguage("eng");
      await worker.initialize("eng");
      const { data } = await worker.recognize(file);
      await worker.terminate();
      setOcrText(data.text);
      // auto-generate quiz
      const q = extractHardQuestions(data.text, 6);
      setGeneratedQuiz(q);
    } catch (err) {
      console.error(err);
      alert("OCR failed: " + err.message);
    } finally {
      setOcrLoading(false);
    }
  }

  function handleSendMessage() {
    if (!message.trim()) return;
    const newMsg = { id: Date.now(), text: message, from: "You", time: new Date().toLocaleTimeString() };
    setChatMessages(prev => [...prev, newMsg]);
    setMessage("");
  }

  function handleFriendClick() {
    // trigger dangerous animation briefly, then reveal group UI
    setDangerAnim(true);
    setTimeout(() => {
      setDangerAnim(false);
      setGroupVisible(true);
    }, 2500); // 2.5 seconds animation
  }

  function handleAddUser() {
    const newName = "User" + Math.floor(Math.random() * 900 + 100);
    setOnlineUsers(prev => [...prev, newName]);
  }

  function handleGenerateQuizFromText(textInput) {
    const q = extractHardQuestions(textInput || ocrText, 6);
    setGeneratedQuiz(q);
  }

  function handleSendImageToChat(file) {
    if (!file) return;
    const url = URL.createObjectURL(file);
    const newMsg = { id: Date.now(), text: "[Image]", image: url, from: "You", time: new Date().toLocaleTimeString() };
    setChatMessages(prev => [...prev, newMsg]);
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-indigo-50 to-white p-6 font-sans">
      <header className="max-w-4xl mx-auto">
        <div className="flex items-center justify-between">
          <h1 className="text-3xl font-extrabold">FutureMind</h1>
          <nav className="space-x-4">
            <button onClick={() => setPage("home")} className="px-3 py-1 rounded hover:bg-indigo-100">Home</button>
            <button onClick={() => setPage("quiz")} className="px-3 py-1 rounded hover:bg-indigo-100">Quiz</button>
            <button onClick={() => setPage("paper")} className="px-3 py-1 rounded hover:bg-indigo-100">Generate Question Paper</button>
            <button onClick={() => setPage("chat")} className="px-3 py-1 rounded hover:bg-indigo-100">Chat</button>
          </nav>
        </div>
      </header>

      <main className="max-w-4xl mx-auto mt-8">
        {page === "home" && (
          <section className="bg-white p-6 rounded-2xl shadow-lg relative overflow-hidden">
            {/* Rocket animation */}
            <div className="flex items-center space-x-6">
              <div className="w-40 h-40 relative">
                <div className={`rocket absolute bottom-0 left-0 transform ${dangerAnim ? "danger-rocket" : ""}`}></div>
              </div>
              <div>
                <div className="text-lg">Created by <span className="font-semibold">Asus Kumar</span></div>
                <p className="mt-2">Welcome to FutureMind — click buttons to explore interactive quiz & group features.</p>
                <div className="mt-4 flex gap-3">
                  <button onClick={() => setPage("quiz")} className="px-4 py-2 rounded bg-indigo-600 text-white">Take Quiz</button>
                  <button onClick={() => setPage("paper")} className="px-4 py-2 rounded border">Generate Paper</button>
                </div>
              </div>
            </div>

            <div className="mt-6 flex items-center gap-4">
              <img src="https://images.unsplash.com/photo-1512820790803-83ca734da794?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=12345" alt="book" className="w-32 h-40 object-cover rounded shadow" />
              <div className="text-sm text-gray-600">A sample book image — replace with your own book cover.</div>
            </div>

            <div className="mt-6 text-xs text-gray-500">Tip: Use the 'Friend' button to see group & dangerous animation.</div>
            <div className="mt-4">
              <button onClick={handleFriendClick} className="px-4 py-2 rounded bg-red-500 text-white">Friend</button>
            </div>
          </section>
        )}

        {page === "quiz" && (
          <section className="bg-white p-6 rounded-2xl shadow-lg">
            <h2 className="text-xl font-bold">Quick Quiz Generator</h2>
            <p className="text-sm text-gray-600 mt-1">Type a paragraph or upload an image and press Generate Quiz.</p>

            <textarea value={ocrText} onChange={e => setOcrText(e.target.value)} rows={6} className="w-full mt-3 p-3 border rounded" placeholder="Type/paste text or upload an image..." />

            <div className="mt-3 flex items-center gap-3">
              <input ref={fileInputRef} type="file" accept="image/*" onChange={handleImageUpload} />
              <button onClick={() => handleGenerateQuizFromText(ocrText)} className="px-4 py-2 rounded bg-indigo-600 text-white">Generate Quiz</button>
              <div className="ml-3">{ocrLoading && <span>OCR running...</span>}</div>
            </div>

            {generatedQuiz.length > 0 && (
              <div className="mt-4">
                <h3 className="font-semibold">Generated Quiz</h3>
                <ol className="mt-2 list-decimal ml-5 space-y-2">
                  {generatedQuiz.map(q => (
                    <li key={q.id} className="p-2 bg-indigo-50 rounded">{q.text}</li>
                  ))}
                </ol>
              </div>
            )}
          </section>
        )}

        {page === "paper" && (
          <section className="bg-white p-6 rounded-2xl shadow-lg">
            <h2 className="text-xl font-bold">Generate Question Paper</h2>
            <p className="text-sm text-gray-600 mt-1">Upload photos of textbook pages or paste long text. We'll pick the hardest sentences as questions.</p>

            <div className="mt-3">
              <input type="file" accept="image/*" onChange={handleImageUpload} />
            </div>
            <div className="mt-3">
              <button onClick={() => handleGenerateQuizFromText(ocrText)} className="px-4 py-2 rounded bg-green-600 text-white">Make Paper</button>
            </div>

            <div className="mt-4">
              <h3 className="font-semibold">Question Paper Preview</h3>
              <div className="mt-2 p-4 border rounded">
                {generatedQuiz.length === 0 ? (
                  <div className="text-sm text-gray-500">No questions yet — upload an image or paste text and click "Make Paper".</div>
                ) : (
                  <ol className="list-decimal ml-5 space-y-2">
                    {generatedQuiz.map(q => (
                      <li key={q.id} className="py-2">{q.text}</li>
                    ))}
                  </ol>
                )}
              </div>
            </div>
          </section>
        )}

        {page === "chat" && (
          <section className="bg-white p-6 rounded-2xl shadow-lg">
            <div className="flex justify-between items-center">
              <h2 className="text-xl font-bold">Built-in Chat</h2>
              <div className="text-sm">Online: <span className="font-semibold">{onlineUsers.length}</span></div>
            </div>

            <div className="mt-4 grid grid-cols-3 gap-4">
              <div className="col-span-2">
                <div className="border h-60 p-3 overflow-auto rounded bg-gray-50">
                  {chatMessages.length === 0 ? (
                    <div className="text-sm text-gray-500">No messages yet.</div>
                  ) : (
                    chatMessages.map(m => (
                      <div key={m.id} className="mb-2">
                        <div className="text-xs text-gray-500">{m.from} • {m.time}</div>
                        <div className="p-2 rounded bg-white shadow-sm">{m.text}{m.image && <img src={m.image} alt="sent" className="mt-2 max-w-xs" />}</div>
                      </div>
                    ))
                  )}
                </div>

                <div className="mt-3 flex gap-2">
                  <input value={message} onChange={e => setMessage(e.target.value)} className="flex-1 p-2 border rounded" placeholder="Type your message..." />
                  <input type="file" accept="image/*" onChange={e => handleSendImageToChat(e.target.files[0])} />
                  <button onClick={handleSendMessage} className="px-4 py-2 rounded bg-indigo-600 text-white">Send</button>
                </div>

                <div className="mt-3 flex gap-2">
                  <button onClick={() => handleGenerateQuizFromText(ocrText)} className="px-3 py-1 rounded border">Generate Quiz from Chat Text</button>
                  <button onClick={() => alert('Ask-question box is the chat input — type your question and press Send.') } className="px-3 py-1 rounded border">Ask Question</button>
                </div>
              </div>

              <aside className="col-span-1">
                <div className="p-3 border rounded">
                  <div className="flex items-center justify-between mb-3">
                    <strong>Group</strong>
                    <button onClick={() => setGroupVisible(!groupVisible)} className="text-sm rounded px-2 py-1 border">{groupVisible ? 'Hide' : 'Show'}</button>
                  </div>

                  {groupVisible && (
                    <div>
                      <div className="text-xs text-gray-500 mb-2">Online users</div>
                      <ul className="space-y-2">
                        {onlineUsers.map((u, idx) => (
                          <li className="flex items-center justify-between" key={idx}>
                            <span>{u}</span>
                            <span className="text-xs text-gray-400">●</span>
                          </li>
                        ))}
                      </ul>

                      <div className="mt-3 flex gap-2">
                        <button onClick={handleAddUser} className="px-3 py-1 rounded border">Add People</button>
                        <button onClick={() => navigator.clipboard?.writeText(window.location.href)} className="px-3 py-1 rounded border">Invite Link</button>
                      </div>
                    </div>
                  )}
                </div>

                <div className="mt-4 p-3 border rounded">
                  <div className="text-sm">Gallery</div>
                  <div className="mt-2">
                    <input type="file" accept="image/*" onChange={e => handleSendImageToChat(e.target.files[0])} />
                  </div>
                </div>
              </aside>
            </div>
          </section>
        )}

        {/* Dangerous animation overlay */}
        {dangerAnim && (
          <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
            <div className="p-8 rounded-full bg-red-600/80 animate-pulse shadow-2xl transform scale-105">
              <div className="text-white font-bold text-xl">DANGER</div>
            </div>
          </div>
        )}

        {/* Footer controls */}
        <footer className="mt-8 text-center text-sm text-gray-500">
          FutureMind • Demo UI • Replace images and fine-tune logic as needed.
        </footer>
      </main>

      {/* Inline styles for rocket and small animations */}
      <style>{`
        .rocket {
          width: 80px;
          height: 120px;
          background: linear-gradient(180deg,#fff,#f0f0f8);
          border-radius: 12px;
          box-shadow: 0 10px 20px rgba(0,0,0,0.1);
          position: absolute;
          left: 0;
          bottom: 0;
          animation: float 3s ease-in-out infinite;
        }
        .rocket:before {
          content: '';
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          bottom: -18px;
          width: 20px;
          height: 20px;
          background: orange;
          border-radius: 50%;
          box-shadow: 0 0 12px 6px rgba(255,165,0,0.3);
          animation: flame 0.2s linear infinite;
        }
        @keyframes float {
          0% { transform: translateY(0) translateX(0) }
          50% { transform: translateY(-18px) translateX(8px) }
          100% { transform: translateY(0) translateX(0) }
        }
        @keyframes flame {
          0% { opacity: 1; transform: scale(1) }
          100% { opacity: 0.2; transform: scale(0.6) }
        }
        .danger-rocket { filter: hue-rotate(260deg) contrast(1.2) }
      `}</style>
    </div>
  );
}
        
